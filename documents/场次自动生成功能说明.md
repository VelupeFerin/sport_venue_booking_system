# 场次自动生成功能说明

## 功能概述

本系统实现了根据场次模板自动生成次日场次的功能，包括：

1. **每日0点自动生成**：系统会在每日0点自动根据场次模板生成次日的场次
2. **启动时初始化**：程序启动时会检查场次表是否为空，如果为空则自动执行场次生成流程
3. **清除过期场次**：自动清除已过期的场次记录
4. **重试机制**：场次生成失败时最多重试3次
5. **完整模板覆盖**：生成所有场次模板对应的场次，包括不开放的场次（以保留备注信息）

## 核心组件

### 1. Session实体类
- 位置：`com.sport_venue_booking_system.entity.Session`
- 对应数据库中的`session`表
- 包含场次的基本信息：场地名称、开始时间、价格、状态等

### 2. SessionRepository
- 位置：`com.sport_venue_booking_system.repository.SessionRepository`
- 提供场次相关的数据库操作方法
- 包含删除过期场次、查询指定日期范围场次等方法

### 3. SessionService
- 接口：`com.sport_venue_booking_system.service.SessionService`
- 实现：`com.sport_venue_booking_system.service.impl.SessionServiceImpl`
- 提供场次业务逻辑处理，包括：
  - 根据模板生成次日场次（包括不开放的场次）
  - 清除过期场次
  - 场次状态管理

### 4. SessionSchedulerService
- 位置：`com.sport_venue_booking_system.service.SessionSchedulerService`
- 定时任务服务，负责每日0点自动执行场次生成
- 包含重试机制，最多重试3次

### 5. SessionController
- 位置：`com.sport_venue_booking_system.controller.SessionController`
- 提供场次相关的REST API接口
- 支持手动触发场次生成和清除过期场次

## 功能特性

### 1. 自动生成机制
- **触发时间**：每日0点自动执行
- **生成逻辑**：根据所有场次模板生成次日场次（包括激活和不激活的模板）
- **去重处理**：避免重复生成已存在的场次
- **批量保存**：使用批量保存提高性能
- **备注保留**：保留模板中的备注信息，包括不开放场次的原因说明

### 2. 重试机制
- **最大重试次数**：3次
- **重试间隔**：5秒
- **异常处理**：捕获并记录异常信息
- **成功判断**：根据生成结果判断是否成功

### 3. 启动时初始化
- **检查条件**：检查场次表是否为空
- **初始化流程**：清除过期场次 → 生成次日场次
- **日志记录**：记录初始化过程和结果

### 4. 过期场次清理
- **清理时机**：每日0点定时清理 + 启动时清理
- **清理条件**：场次开始时间 < 当前时间
- **事务处理**：使用事务确保数据一致性

### 5. 完整模板覆盖
- **生成范围**：所有场次模板（激活和不激活）
- **状态保持**：生成的场次保持模板的激活状态
- **备注传递**：完整传递模板中的备注信息
- **用途说明**：不开放的场次可用于说明维护、故障等原因

## 
